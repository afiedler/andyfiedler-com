{"pageProps":{"postData":{"id":"connecting-to-heroku-postgres-in-python","contentHtml":"<p>This is for Python 3, using <code>psycopg2</code>:</p>\n<div><pre><code><span>import</span> psycopg2\n<span>import</span> subprocess\n\nproc <span>=</span> subprocess<span>.</span>Popen<span>(</span><span>'heroku config:get DATABASE_URL -a my-heroku-app'</span><span>,</span> stdout<span>=</span>subprocess<span>.</span>PIPE<span>,</span> shell<span>=</span><span>True</span><span>)</span>\ndb_url <span>=</span> proc<span>.</span>stdout<span>.</span>read<span>(</span><span>)</span><span>.</span>decode<span>(</span><span>'utf-8'</span><span>)</span><span>.</span>strip<span>(</span><span>)</span> <span>+</span> <span>'?sslmode=require'</span>\n\nconn <span>=</span> psycopg2<span>.</span>connect<span>(</span>db_url<span>)</span>\n</code></pre></div>\n<p>Make sure you've installed Postgres locally with SSL support. Here's how I did it:</p>\n<div><pre><code>brew <span>install</span> postgres --with-openssl\npip3 <span>install</span> psycopg2\n</code></pre></div>\n<p>For some reason, Postgres.app did not work for me. Instead, I needed to use the Homebrew version.</p>\n<h2>Using Pandas to make tables in Jupyter</h2>\n<p>If you are using Jupyter, you can use Pandas to make nice tables from SQL queries:</p>\n<div><pre><code><span>from</span> sqlalchemy <span>import</span> create_engine\n<span>import</span> pandas <span>as</span> pd\n<span>import</span> subprocess\n\nproc <span>=</span> subprocess<span>.</span>Popen<span>(</span><span>'heroku config:get DATABASE_URL -a my-heroku-app'</span><span>,</span> stdout<span>=</span>subprocess<span>.</span>PIPE<span>,</span> shell<span>=</span><span>True</span><span>)</span>\ndb_url <span>=</span> proc<span>.</span>stdout<span>.</span>read<span>(</span><span>)</span><span>.</span>decode<span>(</span><span>'utf-8'</span><span>)</span><span>.</span>strip<span>(</span><span>)</span> <span>+</span> <span>'?sslmode=require'</span>\n\nengine <span>=</span> create_engine<span>(</span>db_url<span>)</span>\npd<span>.</span>read_sql_query<span>(</span><span>'select id, email from users'</span><span>,</span> con<span>=</span>engine<span>)</span>\n</code></pre></div>\n<p>That will give you a nice table like this:\n{% picture pandas_jupyter.png %}</p>\n","layout":"post","title":"Connecting to Heroku Postgres in Python"}},"__N_SSG":true}