{"pageProps":{"postData":{"id":"connecting-to-heroku-postgres-in-python","contentHtml":"<p>This is for Python 3, using <code>psycopg2</code>:</p>\n<div class=\"remark-highlight\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> psycopg2\n<span class=\"token keyword\">import</span> subprocess\n\nproc <span class=\"token operator\">=</span> subprocess<span class=\"token punctuation\">.</span>Popen<span class=\"token punctuation\">(</span><span class=\"token string\">'heroku config:get DATABASE_URL -a my-heroku-app'</span><span class=\"token punctuation\">,</span> stdout<span class=\"token operator\">=</span>subprocess<span class=\"token punctuation\">.</span>PIPE<span class=\"token punctuation\">,</span> shell<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\ndb_url <span class=\"token operator\">=</span> proc<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'?sslmode=require'</span>\n\nconn <span class=\"token operator\">=</span> psycopg2<span class=\"token punctuation\">.</span>connect<span class=\"token punctuation\">(</span>db_url<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>Make sure you've installed Postgres locally with SSL support. Here's how I did it:</p>\n<div class=\"remark-highlight\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> postgres --with-openssl\npip3 <span class=\"token function\">install</span> psycopg2\n</code></pre></div>\n<p>For some reason, Postgres.app did not work for me. Instead, I needed to use the Homebrew version.</p>\n<h2>Using Pandas to make tables in Jupyter</h2>\n<p>If you are using Jupyter, you can use Pandas to make nice tables from SQL queries:</p>\n<div class=\"remark-highlight\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sqlalchemy <span class=\"token keyword\">import</span> create_engine\n<span class=\"token keyword\">import</span> pandas <span class=\"token keyword\">as</span> pd\n<span class=\"token keyword\">import</span> subprocess\n\nproc <span class=\"token operator\">=</span> subprocess<span class=\"token punctuation\">.</span>Popen<span class=\"token punctuation\">(</span><span class=\"token string\">'heroku config:get DATABASE_URL -a my-heroku-app'</span><span class=\"token punctuation\">,</span> stdout<span class=\"token operator\">=</span>subprocess<span class=\"token punctuation\">.</span>PIPE<span class=\"token punctuation\">,</span> shell<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span>\ndb_url <span class=\"token operator\">=</span> proc<span class=\"token punctuation\">.</span>stdout<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strip<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'?sslmode=require'</span>\n\nengine <span class=\"token operator\">=</span> create_engine<span class=\"token punctuation\">(</span>db_url<span class=\"token punctuation\">)</span>\npd<span class=\"token punctuation\">.</span>read_sql_query<span class=\"token punctuation\">(</span><span class=\"token string\">'select id, email from users'</span><span class=\"token punctuation\">,</span> con<span class=\"token operator\">=</span>engine<span class=\"token punctuation\">)</span>\n</code></pre></div>\n<p>That will give you a nice table like this:\n{% picture pandas_jupyter.png %}</p>\n","layout":"post","title":"Connecting to Heroku Postgres in Python"}},"__N_SSG":true}