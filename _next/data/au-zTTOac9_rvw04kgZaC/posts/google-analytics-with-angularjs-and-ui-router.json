{"pageProps":{"postData":{"id":"google-analytics-with-angularjs-and-ui-router","contentHtml":"<p>I helped <a href=\"http://www.cleanslatedc.com/\">Clean Slate DC</a> add Google Analytics to their app last night at <a href=\"http://codefordc.org\">Code For DC</a> and realized others might not know how to do this. It's pretty simple, but you won't want to follow the directions on Google Analytics exactly. Instead, add this to your <code>index.html</code> or main page <code>&#x3C;head></code>, replacing your UA code with the UA code that Google gives you:</p>\n<div class=\"remark-highlight\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token comment\">&#x3C;!-- Google Analytics --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i<span class=\"token punctuation\">,</span>s<span class=\"token punctuation\">,</span>o<span class=\"token punctuation\">,</span>g<span class=\"token punctuation\">,</span>r<span class=\"token punctuation\">,</span>a<span class=\"token punctuation\">,</span>m</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">[</span><span class=\"token string\">'GoogleAnalyticsObject'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>r<span class=\"token punctuation\">;</span>i<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>i<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token operator\">||</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n<span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">q</span><span class=\"token operator\">=</span>i<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">q</span><span class=\"token operator\">||</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>i<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">l</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token operator\">*</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>a<span class=\"token operator\">=</span>s<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\nm<span class=\"token operator\">=</span>s<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementsByTagName</span><span class=\"token punctuation\">(</span>o<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>a<span class=\"token punctuation\">.</span><span class=\"token property-access\">async</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>a<span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span><span class=\"token operator\">=</span>g<span class=\"token punctuation\">;</span>m<span class=\"token punctuation\">.</span><span class=\"token property-access\">parentNode</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">insertBefore</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span>m<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token dom variable\">window</span><span class=\"token punctuation\">,</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">,</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'//www.google-analytics.com/analytics.js'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'ga'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'create'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'UA-XXXX-X'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'auto'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>script</span><span class=\"token punctuation\">></span></span>\n<span class=\"token comment\">&#x3C;!-- End Google Analytics --></span>\n</code></pre></div>\n<p>Next, add a service to your Angular project:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\">angular<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">service</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Analytics'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">recordPageview</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'set'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'page'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ga</span><span class=\"token punctuation\">(</span><span class=\"token string\">'send'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'pageview'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>Finally, add a run block near where your app starts:</p>\n<div class=\"remark-highlight\"><pre class=\"language-javascript\"><code class=\"language-javascript\">angular<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">module</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">run</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">$rootScope<span class=\"token punctuation\">,</span> $<span class=\"token dom variable\">location</span><span class=\"token punctuation\">,</span> <span class=\"token maybe-class-name\">Analytics</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  $rootScope<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">$on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'$stateChangeSuccess'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token maybe-class-name\">Analytics</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">recordPageview</span><span class=\"token punctuation\">(</span>$<span class=\"token dom variable\">location</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">url</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre></div>\n<p>There you go!</p>\n","layout":"post","status":"publish","published":true,"title":"Google Analytics with AngularJS and UI-Router","author":{"display_name":"afiedler","login":"afiedler","email":"andy@andyfiedler.com","url":""},"author_login":"afiedler","author_email":"andy@andyfiedler.com","wordpress_id":337,"wordpress_url":"http://andyfiedler.com/?p=337","date":"2015-07-29 12:54:59 -0400","date_gmt":"2015-07-29 16:54:59 -0400","categories":["Scrapbook"],"tags":["angularjs","google-analytics"]}},"__N_SSG":true}