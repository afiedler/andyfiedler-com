<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="google-site-verification" content="-Dvab_6VGkQMicZl4INhBCLfzJs7AWMwuSpN8CmbjVA" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Andy Fiedler &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/fiedler.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">

  <!-- Icons -->

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- JS -->
  <script>
    // Picture element HTML5 shiv
    document.createElement( "picture" );
  </script>
  <script async src="/public/js/picturefill.min.js"></script>
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>
        <a href="/">
          Andy Fiedler
        </a>
      </h1>
      <p class="lead"></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">Home</a>

      

      
      
        
          
        
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            
              <a class="sidebar-nav-item" href="/projects/">Projects</a>
            
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      

    </nav>

    <div class="sidebar-footer">
      <p>&copy; 2021 <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC</a>.</p>
    </div>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/04/writing-zero-downtime-migrations-for-rails-and-postgres">
        Writing Zero-Downtime Migrations for Rails and Postgres
      </a>
    </h1>

    <span class="post-date">18 Apr 2014</span>

    <p>Let’s suppose you are building an app. It is under heavy development and the dev team is cranking out new features left and right. Developers need to continually change the database schema, but you don’t want to take down the app for database migrations if at all possible. How the heck do you do this with Rails?</p>

<p>We had this problem recently, and have come up with a procedure that solves it for most small database migrations. The goals of this procedure are to:</p>
<ul>
	<li>Avoid downtime by running database migrations while the app is live</li>
	<li>Avoid too many separate deployments to production</li>
	<li>Keep the application code as clean as possible</li>
	<li>Balance the cost of additional coding with the benefit of having a zero-downtime migration. If the cost or complexity of coding a migration in this way is too great, then a maintenance window is scheduled and the migration is written in a non-zero downtime fashion.</li>
</ul>
<p>The first thing to understand when writing a zero downtime migration is what types of Postgres data definition language (DDL) queries can be run without locking tables. As of Postgres 9.3, the following DDL queries can be run without locking a table:</p>
<pre class="toolbar:2 nums:false nums-toggle:false lang:pgsql decode:true">CREATE INDEX CONCURRENTLY</pre>
<p style="padding-left: 30px;">Postgres can create indexes concurrently (without table locks) in most cases. <code>CREATE INDEX CONCURRENTLY</code> can take significantly longer than <code>CREATE INDEX</code>, but it will allow both reads and writes while the index is being generated.</p>

<pre class="toolbar:2 nums:false nums-toggle:false lang:pgsql decode:true">ALTER TABLE ... ADD COLUMN -- certain cases only!</pre>
<p style="padding-left: 30px;">You can add a column to a table without a table lock if the column being added is nullable and has no default value or other constraints.</p>
<p style="padding-left: 30px;">If you want to add a column with a constraint or a column with a default value, one option may be to add the column first without a default value and no constraint, then in a separate transaction set the default value (using <code>UPDATE</code>)  or use <code>CREATE INDEX CONCURRENTLY</code> to add a index that will be used for the constraint. Finally, a third transaction can add the constraint or default to the table. If the third transaction is adding a constraint that uses an existing index, no table scan is required.</p>

<pre class="toolbar:2 nums:false nums-toggle:false lang:pgsql decode:true">ALTER TABLE ... DROP COLUMN</pre>
<p style="padding-left: 30px;">Dropping a column only results in a metadata change, so it is non-blocking. When the table is <code>VACUUMED</code>, the data is actually removed.</p>

<pre class="toolbar:2 nums:false nums-toggle:false lang:pgsql decode:true">CREATE TABLE, CREATE FUNCTION</pre>
<p style="padding-left: 30px;">Creating a table or a function is obviously safe because no one will have a lock on these objects before they are created.</p>

<h2>Process for Coding the Migration</h2>
<p>The guidelines I have been using for writing a zero-downtime migration are to:</p>
<ul>
	<li><strong>Step 1: </strong>Write the database migration in Rails.</li>
	<li><strong>Step 2: </strong>Modify the application code in such a way that it will work both before and after the migration has been applied (more details on this below). This will probably entail writing code that branches depending on that database state.</li>
	<li><strong>Step 3: </strong>Run your test suite with the modified code in step 2<i> but before you apply the database migration!</i></li>
	<li><strong>Step 4: </strong>Run your test suite with the modified code in step 2 <em>after applying the database migration</em>. Tests should pass in both cases.</li>
	<li><strong>Step 5: </strong>Create a pull request on Github (or the equivalent in whatever tool you are using). Tag this in such a way that whoever is reviewing your code knows that there is a database migration that needs careful review.</li>
	<li><strong>Step 6: </strong>Create a separate pull request on Github that cleans up the branching code you wrote in step 2. The code you write in this step can assume that the DB is migrated.</li>
</ul>
<p>When the migration is deployed, you’ll deploy first the code reviewed in step 5. This code will be running against the non-migrated database, but that is a-ok because you have tested that case in step 3. Next, you will run the migration “live”. Once the migration is applied, you will still be running the code reviewed in step 5, but against the migrated database. Again, this is fine because you have tested that in step 4.<strong>
</strong></p>

<p>Finally, once the production database has been migrated, you should merge your pull request from step 6. This eliminates the dead code supporting the unmigrated version of the database. You should write the code for step 6 at the same time you write the rest of this code. Then just leave the pull request open until you are ready to merge. The advantage of this is that you will be “cleaning up” the extraneous code while it is still fresh in your mind.</p>
<h2>Branching Application Code to Support Multiple DB States</h2>
<p>The key to making this strategy work is that you’ll need to write you application code in step 2 in a way that supports two database states: the pre-migrated state and the post-migrated state. The way to do this is to check the database state in the models and branch accordingly.</p>

<p>Suppose you are dropping a column called “deleted”. Prior to dropping the column, you have a default scope that excludes deleted rows. After dropping the column, you want the default scope to include all rows.</p>

<p>You would code a migration to do that like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DropDeletedFromPosts</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
   <span class="k">def</span> <span class="nf">up</span>
     <span class="n">drop_column</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">:deleted</span>
   <span class="k">end</span>

   <span class="k">def</span> <span class="nf">down</span>
      <span class="n">add_column</span> <span class="ss">:posts</span><span class="p">,</span> <span class="ss">:boolean</span><span class="p">,</span> <span class="ss">:deleted</span><span class="p">,</span> <span class="ss">default: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span>
   <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Then, in your Post model, you’d add branching like this:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Post</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>

   <span class="c1"># TODO: Remove this code after the DropDeletedFromPosts migration has</span>
   <span class="c1"># been applied.</span>
   <span class="k">if</span> <span class="no">Post</span><span class="p">.</span><span class="nf">attribute_names</span><span class="p">.</span><span class="nf">include?</span> <span class="s1">'deleted'</span>
      <span class="n">default_scope</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">where</span><span class="p">(</span><span class="ss">deleted: </span><span class="kp">false</span><span class="p">)</span> <span class="p">}</span>
   <span class="k">end</span>

   <span class="c1"># Other model code here ...</span>

<span class="k">end</span>
</code></pre></div></div>

<h3> But doesn't this get complicated for larger migrations?</h3>
<p>Yes, absolutely it does. What we do when branching like this and it gets too complicated, we either sequence the DB changes over multiple deployments (and multiple sprints in the Agile sense) or “give up” and schedule a maintenance window (downtime) to do the change.</p>

<p>Writing zero-downtime migrations is not easy, and you’ll need to do a cost-benefit analysis between scheduling downtime and writing lots of hairy branching code to support a zero-downtime deploy. That decision will depend on how downtime impacts your customers and your development schedule.</p>

<p>Hopefully, if you decide to go the zero-downtime route, this procedure will make your life easier!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/03/querying-inside-postgres-json-arrays">
        Querying Inside Postgres JSON Arrays
      </a>
    </h1>

    <span class="post-date">14 Mar 2014</span>

    <p>Postgres JSON support is pretty amazing. I’ve been using it extensively for storing semi-structured data for a project and it has been great for that use case. In Postgres 9.3, the maintainers added the ability to perform some simple queries on JSON structures and a few functions to convert from JSON to Postgres arrays and result sets.</p>

<p>One feature that I couldn’t figure out how to implement using the built-in Postgres functions was the ability to query within a JSON array. This is fairly critical for lots of the reporting queries that I’ve been building over the part few days. Suppose you have some JSON like this, stored in two rows in a table called “orders”, in the column “json_field”:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Row 1, "json_field" column -----</span>
<span class="p">{</span>
   <span class="dl">"</span><span class="s2">products</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Fish Tank</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bird Feeder</span><span class="dl">"</span> <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="c1">// Row 2, "json_field" column -----</span>
<span class="p">{</span>
   <span class="dl">"</span><span class="s2">products</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Bird Feeder</span><span class="dl">"</span> <span class="p">},</span>
      <span class="p">{</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Cat Pole</span><span class="dl">"</span> <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>If you want to run a query like “find all distinct IDs in the json_field’s products array”, you can’t do that with the built in JSON functions that Postgres currently supplies (as far as I’m aware!). This is a fairly common use case, especially for reporting.</p>

<p>To get this work, I wrote this simple PgPL/SQL function to map a JSON array.</p>

<pre><code class="language-pgpsql">CREATE OR REPLACE FUNCTION json_array_map(json_arr json, path TEXT[]) RETURNS json[]
LANGUAGE plpgsql IMMUTABLE AS $$
DECLARE
	rec json;
	len int;
	ret json[];
BEGIN
	-- If json_arr is not an array, return an empty array as the result
	BEGIN
		len := json_array_length(json_arr);
	EXCEPTION
		WHEN OTHERS THEN
			RETURN ret;
	END;

	-- Apply mapping in a loop
	FOR rec IN SELECT json_array_elements#&gt;path FROM json_array_elements(json_arr)
	LOOP
		ret := array_append(ret,rec);
	END LOOP;
	RETURN ret;
END $$;
</code></pre>

<p>What this function does is given a JSON array as “json_arr” and a JSON path as “path”, it will loop through all elements of the JSON array, locate the element at the path, and store it in a Postgres native array of JSON elements. You can then use other Postgres array functions to aggregate it.</p>

<p>For the query above where we want to find distinct product IDs in the orders table, we could write something like this:</p>

<pre><code class="language-pgpsql">SELECT DISTINCT unnest(json_array_map(orders.json_field#&gt;'{products}', '{id}'::text[]))::text AS "id" FROM orders;
</code></pre>

<p>That would give you the result:</p>
<pre> id
-----
 2
 3
 1</pre>
<p>Pretty cool!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/02/volatility-of-bitcoin-index">
        Volatility of Bitcoin Index
      </a>
    </h1>

    <span class="post-date">24 Feb 2014</span>

    <p>A while back when I was a research assistant at the Federal Reserve, I worked on a project to make exchange rate volatility indexes for the major world currencies. We basically had some high frequency data for USD/EUR, USD/CHF, and USD/JPY and wanted to see how the financial crisis affected volatility. With all of the hype and turmoil around Bitcoin, I though it would be interesting to make a similar index for the Bitcoin/USD exchange rate.</p>

<p>Before Bitcoin is ever able to become a viable “currency”, volatility needs to come down a lot. Low volatility isn’t sufficient for it to take off, but is probably is necessary. If you take the traditional definition of a currency as a “store of value”, a “medium of exchange”, and a “unit of account”, persistently high volatility is absolutely a death knell. This is especially true in Bitcoin’s case where there is no government backing and there are attractive substitutes in traditional currencies.</p>

<p>One of the cool things about Bitcoin, however, is that lots of the data is fairly open. Most of the rest of the financial market data in the U.S. is behind the copyright lock and seal of the major exchanges and electronic trading networks. Both the NYSE and NASDAQ make lots of money off of selling market data, and they recently won <a title="SEC court case on market data fees" href="http://www.reuters.com/article/2013/04/30/us-sec-exchanges-netcoalition-idUSBRE93T0Q220130430">a court case to raise their rates even further</a>. That makes doing this kind of analysis on other securities an expensive endeavor for armchair quarterbacks like myself!</p>

<p>Bitcoin, however, has a rather open ethos and most of the exchanges publish realtime or near-realtime price data for free. CoinDesk aggregates this into their <a title="Bitcoin Price Index" href="http://www.coindesk.com/price/">Bitcoin Price Index</a>, which they graciously agreed to send over for this analysis.</p>

<p>The Volatility of Bitcoin Index (VOB Index—I’m open to suggestions on the name) is a simple rolling standard deviation of minutely log-returns. That is not nearly as complicated as it sounds. To create the index, I started with a time series of minutely Bitcoin price data and calculated the <a title="Wikipedia - Log Returns" href="http://en.wikipedia.org/wiki/Rate_of_return#Comparing_ordinary_return_with_logarithmic_return">log returns</a> (basically percent increase or decrease for each minute).  Then for each period, I took all of the returns within a trailing window and computed the standard deviation. I did this for three window lengths: 30, 60 and 90 days, and then annualized it. The Bitcoin markets are 24/7/365, so there are no holiday or weekend adjustments, which makes things a bit easier.</p>

<p>Here’s what the index looks like for the period August 2011 to January 31, 2014.</p>

<p><img class="aligncenter size-full wp-image-256" alt="Volatility of Bitcoin Index" src="http://andyfiedler.com/wp-content/uploads/2014/02/vob_plot.png" width="800" height="462" />Here’s the BPI (Bitcoin Price Index) over that period.</p>

<p><img class="aligncenter size-full wp-image-257" alt="BPI Index" src="http://andyfiedler.com/wp-content/uploads/2014/02/bpi_plot.png" width="800" height="462" />
Bitcoin volatility looks like it is dropping over time, especially from the early days in 2011 and 2012, except for a large bump in volatility in April of 2013. That was probably sparked by problems at Bitcoin’s largest exchange, Mt. Gox during that time period. This decrease is despite an increase in speculative interest in Bitcoin and moves by China to curtail the currency’s use.</p>

<p>Whether Bitcoin takes off is anyone’s guess and predicting if it does is probably a fool’s errand. There are lots of smart people working on it, but big questions about its viability still remain. In either case, it should be exciting to watch!</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/01/tech-predictions-for-2014">
        Tech Predictions for 2014
      </a>
    </h1>

    <span class="post-date">28 Jan 2014</span>

    <p>This is a just a bunch of fun tech predictions for 2014. I can’t claim any insider knowledge, but it will be interesting to look back on them at the end of the year to see what the outcomes are!</p>
<h2>Bitcoin will become "legitimate", but not widespread</h2>
<p>In 2014, regulators will likely issue guidance on how exactly companies and people can deal in Bitcoin without running afoul of anti-money laundering and money transmitter regulations, and how it is to be taxed. This will “legitimize” Bitcoin, but because of the difficulty of using the cryptocurrency and the insane <a title="Bitcoin Volatility - Business Insider" href="http://www.businessinsider.com/bitcoin-volatility-2013-12" target="_blank">amount of volatility of Bitcoin</a> against fiat money, it will not become mainstream in 2014. Instead, Bitcoin will be relegated to particular types of transactions that the mainstream banks are either not accepting (due to the high probability of fraud or high compliance costs) or are charging exorbitant fees to facilitate. These will likely be cross-border transactions, especially in countries with capital controls (Argentina), <a title="Banks Say No to Marijuana Money, Legal or Not - NY Times" href="http://www.nytimes.com/2014/01/12/us/banks-say-no-to-marijuana-money-legal-or-not.html" target="_blank">legally grey-area transactions</a>, or transactions that the major payment processors don’t accept.</p>
<h2>Docker plus Deis or Flynn will result in an "open-source Heroku" and lots of dev-ops innovation</h2>
<p>Heroku is probably one of the biggest dev-ops innovations in the last five years, making it vastly easier to deploy web applications, freeing development teams to actually build applications instead of focusing on DevOps. Heroku’s <a href="http://12factor.net">12 Factor App</a> architecture is now widely used and 2014 will see that continuing. However, Heroku has a few problems.</p>

<p>First, There currently isn’t a good way to “build your own Heroku” out of open source components. If Heroku is too constraining, you are forced to spin up your own servers on Amazon Web Services for part of your application, which eliminates lots of the advantages Heroku brings to the table. Last year there was a ton of excitement about Linux containers (LXC) and Docker, which is abstraction on top of LXC that makes them easier to manage. Both Heroku and Google Cloud use Linux containers internally, but they are closed-source implementations. Docker will likely begin to change that this year.</p>

<p>However, Docker alone is not a Heroku replacement. Much of the innovation in Heroku lies in the build packs and routing mesh, which Docker does not provide. Two other open source projects aim to become that layer on top of Docker, and these are the ones I’m most excited to watch. The first is <a href="http://deis.io/" target="_blank">Deis</a>, which seems to be the furthest along in creating an open-source Heroku. Deis has both a routing mesh and an application layer created as well as scripts to automatically scale your “personal Heroku” on AWS, Digital Ocean and Rackspace. Flynn has many of the same goals, but doesn’t appear to be as far along. Deis has commercial support from Opsware, while <a href="https://flynn.io/" target="_blank">Flynn is raising money Kickstarter-style</a> to build out their platform. In any case, while Heroku is great, it is very exciting to see open source competitors come to the scene.</p>
<h2>AngularJS and EmberJS will win the front-end wars for web apps</h2>
<p>For highly interactive web apps, both AngularJS and EmberJS will become the clear choices in 2014. Backbone, Knockout and other front-end JS frameworks will see declining usage simply because they don’t provide as much of a framework as AngularJS or EmberJS. For new sites except for “CMS-like” apps, people will stop generating HTML on the server and push the page rendering to Javascript on the browser. Because of this, back-end frameworks will pivot towards being better REST API servers and focus less on their HTML template rendering abilities. The wildcard is “CMS-style” sites that need to be indexed by Google. While Google’s crawler can execute Javascript, content-heavy sites will still need a mechanism to serve HTML from the server for reliable SEO. This means that full-stack Rails apps will still be important in 2014. I think the writing is on the wall for this kind of app, however.</p>
<h2>Mobile will continue to be "write twice" for the highest quality</h2>
<p>Unfortunately, while HTML5 is great, it still won’t deliver the highest quality apps on mobile in 2014. As a cost-saving measure, or for apps that don’t need lots of interaction, HTML5 will be a viable choice. However, to create the highest-quality mobile apps in 2014, we’ll still need to write them twice: once for Android and once for iOS.</p>
<h2>Wearable tech won’t be mainstream; in fact, society will push back from being "always connected"</h2>
<p>Google Glass and the like will remain curiosities and not mainstream. In fact, I think that people are beginning to push back from being always connected to the Internet. Smartphone usage in many social situations is become a faux pas and the word <a title="I, Glasshole" href="http://www.wired.com/gadgetlab/2013/12/glasshole/" target="_blank">“glassholes”</a> has already been coined for people that wear Google Glass in public. That being said, we will see the Internet smartly integrated into more consumer products, including continued innovation in automobile technology and home automation. The key for the “Internet of things” in 2014 will be <i>unobtrusive, discrete, and large value-add</i>, which probably isn’t wearable technology in its current form.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2013/08/motorcycling-in-laos">
        Motorcycling in Laos
      </a>
    </h1>

    <span class="post-date">13 Aug 2013</span>

    <p>Last month I spent a week motorcycling around Laos with a friend, starting at the capital and heading north through probably one of the most scenic parts of Southeast Asia. This is still a fairly undeveloped part of the world, meaning empty roads, not many other tourists, and an unspoiled landscape. It also means the logistics of this trip were not easy, but the ride was definitely worth it. If you are interested in doing a trip like this, read on!</p>
<h2>Preparing for the trip</h2>
<p>Roads in Laos range from two lanes and decent blacktop on the main highways to muddy dirt tracks in the villages, so you will want to be a fairly proficient rider with at least some dirt biking experience before you go. We went early in the rainy season, which contributed to the mud, but even in the dry season, a lot of the smaller roads will require some dirt riding skills.</p>

<p>The two most sensible starting points for a trip like this are the capital, Vientiane, and Luang Prabang, a UNESCO World Heritage Town about 340km to the north. Both cities have international airports, but they are very small, so expect to fly through a major Asian hub like Bangkok or Seoul if coming from the U.S. or Europe. You can also take a bus from Thailand, Cambodia or Vietnam if you are already in Southeast Asia, but expect it to be an overnight bus (12 hours+) on mountainous, winding roads.</p>
<h2>Renting bikes</h2>
<p>We rented a Honda CRF250 and CRF230 from <a title="Remote Asia Outfitters" href="http://remoteasia.com" target="_blank">Remote Asia</a> in Vientiane, who were excellent. The bikes were in great shape and Jim from Remote Asia was very helpful when we had a minor mishap (I lost an ignition key to my bike!). You really will want to rent bikes from someone who can also provide a cell phone and “roadside assistance”, and by that I mean basically translating via cell phone and recommending mechanics. English is not widely spoken in Laos and emergency services are non-existent, so you will want an English speaking contact in-country from your rental agency.</p>

<p>We had no issues with Laotian police (in fact we did not see any outside of Vientiane), so it would seem that you don’t strictly need an International Drivers License or a motorcycle license at all. Your rental bike should come with a Laotian number plate and turn signals, and riding with a headlight during the day is apparently illegal so should be avoided.</p>
<h2>The route</h2>
<p>Laos has a few excellent motorcycle routes, and the one we took seems to be the most popular. You can order an excellent map of Laos with elevation profiles, road conditions, and city maps from GT Rider in Thailand <a href="http://www.gt-rider.com/maps-of-thailand-laos-maps/laos-guide-map" target="_blank">here</a>. This route took us 6 days of riding at a fairly leisurely pace. There are three long days of riding (over 150km) and one day each spent in Vang Vieng, Ponsavan, and Luang Prabang that you can use to explore the area surrounding these cities.</p>

<p>In addition to the GT Rider map, you should also get an Open Street Map app for your smart phone. OSM actually had pretty good coverage of Laos, including some of the caves and waterfalls outside of the cities. For Android, try <a href="https://play.google.com/store/apps/details?id=net.osmand">OSMAnd</a>, which lets you download country maps for offline use.</p>

<p>Here’s a map of the route we took and details of each leg.</p>

<iframe src="https://maps.google.com/maps/ms?msa=0&amp;msid=213059449424618329795.0004e1d4c6c3d82758c09&amp;ie=UTF8&amp;t=p&amp;ll=18.921876,102.661743&amp;spn=2.494061,3.515625&amp;z=8&amp;output=embed" width="640" height="480" scrolling="no" frameborder="0" securitykey="da39a3ee5e6b4b0d3255bfef95601890afd80709"></iframe>

<p> </p>
<h3>Vientiane to Vang Vieng, 154km</h3>
<p><img src="/generated/wp/uploads/2013/08/IMG_20130712_134937-800-ea6376aff.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130712_134937-400-ea6376aff.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130712_134937-600-ea6376aff.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130712_134937-800-ea6376aff.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130712_134937-1000-ea6376aff.jpg 1000w" /></p>

<p><img src="/generated/wp/uploads/2013/08/IMG_20130712_145318-800-fac0b42a3.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130712_145318-400-fac0b42a3.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130712_145318-600-fac0b42a3.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130712_145318-800-fac0b42a3.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130712_145318-1000-fac0b42a3.jpg 1000w" /></p>

<p><img src="/generated/wp/uploads/2013/08/IMG_20130712_124142-800-963aebf90.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130712_124142-400-963aebf90.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130712_124142-600-963aebf90.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130712_124142-800-963aebf90.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130712_124142-1000-963aebf90.jpg 1000w" /></p>

<p>If picking up your bikes in Vientiane, likely your first stop will be <a href="http://en.wikipedia.org/wiki/Vang_Vieng" target="_blank">Vang Vieng</a>. The ride to Vang Vieng is 154 km and fairly easy and flat until the last 50km or so where there are some small hills. Leaving Vientiane is where you will probably encounter the most traffic of the trip (not much!), but within 50km, it drops off a lot.</p>

<p>Vang Vieng is a tourist town along the Nam Song river with lots of caving, waterfalls, and rafting available nearby. It is definitely worth at least one whole day exploring outside of the town. I think of the three towns we visited, Vang Vieng had the most spectacular scenery. The town is surrounded by a dramatic <a href="http://en.wikipedia.org/wiki/Karst_topography">karst landscape</a> that is even more surreal in the rainy season when the peaks are surrounded in fog. In Vang Vieng, we went to a cave, waterfall and “blue lagoon” (swimming hole) on our one full day there. These were all found on dirt paths leading out from the town, for which Open Street Map was a real help locating.</p>
<h3>Vang Vieng to Ponsavan, 233km</h3>
<p><img src="/generated/wp/uploads/2013/08/IMG_20130713_074030-800-bf87cfc73.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130713_074030-400-bf87cfc73.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130713_074030-600-bf87cfc73.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130713_074030-800-bf87cfc73.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130713_074030-1000-bf87cfc73.jpg 1000w" /></p>

<p><img src="/generated/wp/uploads/2013/08/IMG_20130714_074338-800-79eab927b.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130714_074338-400-79eab927b.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130714_074338-600-79eab927b.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130714_074338-800-79eab927b.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130714_074338-1000-79eab927b.jpg 1000w" /></p>

<p><img src="/generated/wp/uploads/2013/08/IMG_20130713_142645-800-b968f1cf2.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130713_142645-400-b968f1cf2.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130713_142645-600-b968f1cf2.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130713_142645-800-b968f1cf2.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130713_142645-1000-b968f1cf2.jpg 1000w" /></p>

<p>The second long day of riding, Vang Vieng to Ponsavan, is 233 km of challenging riding with tons of very steep switchbacks and incredible views of some of the highest peaks in Laos. On this part of the ride, you are heading to <a href="http://wikitravel.org/en/Phonsavan">Ponsavan</a>, which is the capital of the providence containing the <a href="http://wikitravel.org/en/Plain_of_Jars">Plain of Jars</a>, a neolithic archeological site with large stone jars (some over 4 feet tall). The Plain of Jars was also bombed heavily during the Vietnam War as part of the CIA’s covert war in Laos, so there is lots of war history in this area as well. Ponsavan has a few NGOs operating to clear unexploded ordinance that have interesting exhibits in the town on the war.</p>
<h3>Ponsavan to Luang Prabang, 259km</h3>
<p><img src="/generated/wp/uploads/2013/08/IMG_20130715_111204-800-92f15b1ac.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130715_111204-400-92f15b1ac.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130715_111204-600-92f15b1ac.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130715_111204-800-92f15b1ac.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130715_111204-1000-92f15b1ac.jpg 1000w" /></p>

<p><img src="/generated/wp/uploads/2013/08/IMG_20130718_143756-800-cca6c1128.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130718_143756-400-cca6c1128.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130718_143756-600-cca6c1128.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130718_143756-800-cca6c1128.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130718_143756-1000-cca6c1128.jpg 1000w" /></p>

<p><img src="/generated/wp/uploads/2013/08/IMG_20130716_083641-800-551cb1517.jpg" srcset="/generated/wp/uploads/2013/08/IMG_20130716_083641-400-551cb1517.jpg 400w, /generated/wp/uploads/2013/08/IMG_20130716_083641-600-551cb1517.jpg 600w, /generated/wp/uploads/2013/08/IMG_20130716_083641-800-551cb1517.jpg 800w, /generated/wp/uploads/2013/08/IMG_20130716_083641-1000-551cb1517.jpg 1000w" /></p>

<p>The last long day of riding will take you 259 km from Ponsavan to Luang Prabang (backtracking to Pho Khoun, then north to Luang Prabang). Backtracking in this way isn’t all that bad because the scenery and riding is so great heading from Pho Khoun to Ponsavan, you’ll have no problem doing it twice.</p>

<p>Pho Khoun makes a good stopping place for lunch, as its about at the midpoint of this ride and there are a few places to refuel and grab lunch. From Pho Khoun, you’ll have similar riding (and that’s to say great!) to Luang Prabang.</p>

<p><a href="http://wikitravel.org/en/Luang_Prabang">Luang Prabang</a> is a UNESCO World Heritage Site and has by far the best developed tourist infrastructure of the three cities we visited. Luang Prabang is at the intersection of the Mekong River and the Nam Khan River and has a large temple in the center of the city with great views of both rivers. There are waterfalls about 20km outside of town as well as rafting, elephant tours, and kayaking if you choose to stay here for a few days.</p>

<p><img src="/generated/wp/uploads/2013/08/laos_ride_profile-800-7b5fa5e8a.png" srcset="/generated/wp/uploads/2013/08/laos_ride_profile-400-7b5fa5e8a.png 400w, /generated/wp/uploads/2013/08/laos_ride_profile-600-7b5fa5e8a.png 600w, /generated/wp/uploads/2013/08/laos_ride_profile-800-7b5fa5e8a.png 800w, /generated/wp/uploads/2013/08/laos_ride_profile-1000-7b5fa5e8a.png 1000w" /></p>


  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page11">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page9">Newer</a>
    
  
</div>
    </div>

    
      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-25710888-1', 'auto');
  ga('send', 'pageview');

</script>

    
  </body>
</html>
