<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="Andy Fiedler&#x27;s Personal Site"/><title>Connecting to Heroku Postgres in Python</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/588d179d14f543de1f7e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/588d179d14f543de1f7e.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-8495f486508069a84016.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.aa021d425006d69b9da8.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-2f6c726a4c5d3dfd1e8f.js" as="script"/><link rel="preload" href="/_next/static/chunks/0a3463f7b698f32fd7af40216f1292ceb318b3f7.39ce756e4870b72d4174.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-29dccdc32ec4574aab67.js" as="script"/></head><body><div id="__next"><div id="main"><div class="max-w-screen-md mx-auto px-4"><div class="flex items-center justify-between py-6 lg:py-10"><a href="/" class="flex items-center"><p class="font-body font-bold text-2xl text-primary dark:text-white">Andy Fiedler</p></a><div class="flex items-center lg:hidden"><svg width="24" height="15" xmlns="http://www.w3.org/2000/svg" class="fill-current text-primary dark:text-white"><g fill-rule="evenodd"><rect width="24" height="3" rx="1.5"></rect><rect x="8" y="6" width="16" height="3" rx="1.5"></rect><rect x="4" y="12" width="20" height="3" rx="1.5"></rect></g></svg></div><div class="hidden lg:block"><ul class="flex items-center"><li class="mr-6 relative group mb-1"><div class="absolute left-0 bottom-0 w-full transition-all h-0 group-hover:h-2 group-hover:bg-yellow opacity-75 z-20"></div><a href="/posts" class="font-body font-medium text-lg text-primary dark:text-white group-hover:text-green dark:group-hover:text-secondary px-2 z-30 block relative transition-colors">Posts</a></li><li><i class="bx text-3xl text-primary dark:text-white cursor-pointer"></i></li></ul></div><div class="bg-black bg-opacity-80 fixed inset-0 z-20 flex opacity-0 pointer-events-none transition-opacity lg:hidden "><div class="ml-auto bg-blue-600 w-2/3 md:w-1/3 p-4"><svg viewBox="0 0 20 20" width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-white absolute top-0 right-0 mt-4 mr-4"><path d="M15.898,4.045c-0.271-0.272-0.713-0.272-0.986,0l-4.71,4.711L5.493,4.045c-0.272-0.272-0.714-0.272-0.986,0s-0.272,0.714,0,0.986l4.709,4.711l-4.71,4.711c-0.272,0.271-0.272,0.713,0,0.986c0.136,0.136,0.314,0.203,0.492,0.203c0.179,0,0.357-0.067,0.493-0.203l4.711-4.711l4.71,4.711c0.137,0.136,0.314,0.203,0.494,0.203c0.178,0,0.355-0.067,0.492-0.203c0.273-0.273,0.273-0.715,0-0.986l-4.711-4.711l4.711-4.711C16.172,4.759,16.172,4.317,15.898,4.045z"></path></svg><i class="absolute top-0 right-0 mt-4 mr-4"></i><ul class="flex flex-col mt-8"><li class=""><a href="/posts" class="font-body font-medium text-lg text-white px-2 block mb-3">Posts</a></li></ul></div></div></div></div><div class="max-w-screen-md mx-auto px-4"><div class="pt-16 lg:pt-20"><div class="border-b border-grey-lighter pb-8 sm:pb-12"><h2 class="font-body font-semibold text-primary dark:text-white text-3xl sm:text-4xl md:text-5xl block leading-tight">Connecting to Heroku Postgres in Python</h2><div class="flex items-center pt-5 sm:pt-8"><p class="font-body font-light text-primary dark:text-white pr-2"></p></div></div><article class="border-b border-grey-lighter py-8 sm:py-12 prose prose dark:prose-dark max-w-none"><p>This is for Python 3, using <code>psycopg2</code>:</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> psycopg2
<span class="token keyword">import</span> subprocess

proc <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token string">'heroku config:get DATABASE_URL -a my-heroku-app'</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
db_url <span class="token operator">=</span> proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'?sslmode=require'</span>

conn <span class="token operator">=</span> psycopg2<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>db_url<span class="token punctuation">)</span>
</code></pre></div>
<p>Make sure you've installed Postgres locally with SSL support. Here's how I did it:</p>
<div class="remark-highlight"><pre class="language-bash"><code class="language-bash">brew <span class="token function">install</span> postgres --with-openssl
pip3 <span class="token function">install</span> psycopg2
</code></pre></div>
<p>For some reason, Postgres.app did not work for me. Instead, I needed to use the Homebrew version.</p>
<h2>Using Pandas to make tables in Jupyter</h2>
<p>If you are using Jupyter, you can use Pandas to make nice tables from SQL queries:</p>
<div class="remark-highlight"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> subprocess

proc <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token string">'heroku config:get DATABASE_URL -a my-heroku-app'</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
db_url <span class="token operator">=</span> proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'?sslmode=require'</span>

engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span>db_url<span class="token punctuation">)</span>
pd<span class="token punctuation">.</span>read_sql_query<span class="token punctuation">(</span><span class="token string">'select id, email from users'</span><span class="token punctuation">,</span> con<span class="token operator">=</span>engine<span class="token punctuation">)</span>
</code></pre></div>
<p>That will give you a nice table like this:
{% picture pandas_jupyter.png %}</p>
</article></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"connecting-to-heroku-postgres-in-python","contentHtml":"\u003cp\u003eThis is for Python 3, using \u003ccode\u003epsycopg2\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e psycopg2\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e subprocess\n\nproc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e subprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePopen\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'heroku config:get DATABASE_URL -a my-heroku-app'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stdout\u003cspan class=\"token operator\"\u003e=\u003c/span\u003esubprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePIPE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e shell\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndb_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e proc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estdout\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edecode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estrip\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'?sslmode=require'\u003c/span\u003e\n\nconn \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e psycopg2\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003econnect\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edb_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eMake sure you've installed Postgres locally with SSL support. Here's how I did it:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-bash\"\u003e\u003ccode class=\"language-bash\"\u003ebrew \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e postgres --with-openssl\npip3 \u003cspan class=\"token function\"\u003einstall\u003c/span\u003e psycopg2\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eFor some reason, Postgres.app did not work for me. Instead, I needed to use the Homebrew version.\u003c/p\u003e\n\u003ch2\u003eUsing Pandas to make tables in Jupyter\u003c/h2\u003e\n\u003cp\u003eIf you are using Jupyter, you can use Pandas to make nice tables from SQL queries:\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python\"\u003e\u003cspan class=\"token keyword\"\u003efrom\u003c/span\u003e sqlalchemy \u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e create_engine\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e pandas \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e pd\n\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e subprocess\n\nproc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e subprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePopen\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'heroku config:get DATABASE_URL -a my-heroku-app'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e stdout\u003cspan class=\"token operator\"\u003e=\u003c/span\u003esubprocess\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ePIPE\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e shell\u003cspan class=\"token operator\"\u003e=\u003c/span\u003e\u003cspan class=\"token boolean\"\u003eTrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\ndb_url \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e proc\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estdout\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edecode\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'utf-8'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estrip\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e \u003cspan class=\"token string\"\u003e'?sslmode=require'\u003c/span\u003e\n\nengine \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e create_engine\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edb_url\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\npd\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eread_sql_query\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'select id, email from users'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e con\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eengine\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThat will give you a nice table like this:\n{% picture pandas_jupyter.png %}\u003c/p\u003e\n","layout":"post","title":"Connecting to Heroku Postgres in Python"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"connecting-to-heroku-postgres-in-python"},"buildId":"ECKqL40zNVKWw6Vnv9zpb","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-144e5fa6fafab6397d9c.js"></script><script src="/_next/static/chunks/main-8495f486508069a84016.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.aa021d425006d69b9da8.js" async=""></script><script src="/_next/static/chunks/pages/_app-2f6c726a4c5d3dfd1e8f.js" async=""></script><script src="/_next/static/chunks/0a3463f7b698f32fd7af40216f1292ceb318b3f7.39ce756e4870b72d4174.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-29dccdc32ec4574aab67.js" async=""></script><script src="/_next/static/ECKqL40zNVKWw6Vnv9zpb/_buildManifest.js" async=""></script><script src="/_next/static/ECKqL40zNVKWw6Vnv9zpb/_ssgManifest.js" async=""></script></body></html>