<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="description" content="Andy Fiedler&#x27;s Personal Site"/><title>How secure is the OAuth2 &quot;Resource Owner Password Credential&quot; flow for single-page apps?</title><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/3a91f8daa0490311.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3a91f8daa0490311.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-0d72f87c7081bf6b.js" defer=""></script><script src="/_next/static/chunks/main-c1f318e46964e3b2.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a8fa0b8d60e9233f.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-5774d63731fac027.js" defer=""></script><script src="/_next/static/aq3bQL2RdL7dxufxvAbba/_buildManifest.js" defer=""></script><script src="/_next/static/aq3bQL2RdL7dxufxvAbba/_ssgManifest.js" defer=""></script><script src="/_next/static/aq3bQL2RdL7dxufxvAbba/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div id="main"><div class="max-w-screen-md mx-auto px-4"><div class="flex items-center justify-between py-6 lg:py-10"><a href="/" class="flex items-center"><p class="font-body font-bold text-2xl text-primary dark:text-white">Andy Fiedler</p></a><div class="flex items-center lg:hidden"><svg width="24" height="15" xmlns="http://www.w3.org/2000/svg" class="fill-current text-primary dark:text-white"><g fill-rule="evenodd"><rect width="24" height="3" rx="1.5"></rect><rect x="8" y="6" width="16" height="3" rx="1.5"></rect><rect x="4" y="12" width="20" height="3" rx="1.5"></rect></g></svg></div><div class="hidden lg:block"><ul class="flex items-center"><li class="mr-6 relative group mb-1"><div class="absolute left-0 bottom-0 w-full transition-all h-0 group-hover:h-2 group-hover:bg-yellow opacity-75 z-20"></div><a href="/posts" class="font-body font-medium text-lg text-primary dark:text-white group-hover:text-green dark:group-hover:text-secondary px-2 z-30 block relative transition-colors">Posts</a></li><li><i class="bx text-3xl text-primary dark:text-white cursor-pointer"></i></li></ul></div><div class="bg-black bg-opacity-80 fixed inset-0 z-20 flex opacity-0 pointer-events-none transition-opacity lg:hidden "><div class="ml-auto bg-blue-600 w-2/3 md:w-1/3 p-4"><svg viewBox="0 0 20 20" width="24" height="24" xmlns="http://www.w3.org/2000/svg" class="fill-current text-white absolute top-0 right-0 mt-4 mr-4"><path d="M15.898,4.045c-0.271-0.272-0.713-0.272-0.986,0l-4.71,4.711L5.493,4.045c-0.272-0.272-0.714-0.272-0.986,0s-0.272,0.714,0,0.986l4.709,4.711l-4.71,4.711c-0.272,0.271-0.272,0.713,0,0.986c0.136,0.136,0.314,0.203,0.492,0.203c0.179,0,0.357-0.067,0.493-0.203l4.711-4.711l4.71,4.711c0.137,0.136,0.314,0.203,0.494,0.203c0.178,0,0.355-0.067,0.492-0.203c0.273-0.273,0.273-0.715,0-0.986l-4.711-4.711l4.711-4.711C16.172,4.759,16.172,4.317,15.898,4.045z"></path></svg><i class="absolute top-0 right-0 mt-4 mr-4"></i><ul class="flex flex-col mt-8"><li class=""><a href="/posts" class="font-body font-medium text-lg text-white px-2 block mb-3">Posts</a></li></ul></div></div></div></div><div class="max-w-screen-md mx-auto px-4"><div class="pt-16 lg:pt-20"><div class="border-b border-grey-lighter pb-8 sm:pb-12"><h2 class="font-body font-semibold text-primary dark:text-white text-3xl sm:text-4xl md:text-5xl block leading-tight">How secure is the OAuth2 &quot;Resource Owner Password Credential&quot; flow for single-page apps?</h2><div class="flex items-center pt-5 sm:pt-8"><p class="font-body font-light text-primary dark:text-white pr-2">2014-09-08 15:07:47 -0400</p></div></div><article class="border-b border-grey-lighter py-8 sm:py-12 prose prose dark:prose-dark max-w-none"><p>I've been working on a single-page, browser-based app and I was investigating using the OAuth2 "Resource Owner Password Credential" (ROPC) flow to log users in without needing a normal OAuth popup or redirect. The single-page app is written by the same developers as the backend API, so it is more trusted than a third-party application (which should never touch a user's password). However, since it is a client-side application in Javascript, it was unclear to me how to take steps to make this as secure as possible, so I did some research. In this post, I'll describe what I found.</p>
<p>The other issue is that Javascript clients cannot disguise their client credentials because the user may just "view source" to retrieve the credentials. This makes client impersonation possible. It also means the the client is a "public" client for the purposes of the OAuth spec, and client authentication is not possible. The OAuth spec states that when client authentication is not possible, the authorization server SHOULD employ other means to validate the client's identity.</p>
<p>Since we can't completely prevent client impersonation, we need to define what types of impersonation we are trying to prevent. For Javascript clients, I want to prevent two types of impersonation:</p>
<p>In order to use the ROPC grant type for Javascript clients, we need to be more strict than the spec and absolutely ensure that the client is delivered over SSL. If the Javascript client is not delivered over SSL, a middleman could tamper with the client's Javascript to intercept either the resource owner's credentials or the access token. This makes it impossible for the resource owner to trust the client, which breaks the first chain of trust between the resource owner and the authorization server.</p>
<p>You absolutely should implement some kind of rate-limiting on your token endpoint to prevent brute-force attacks.</p>
<p>Finally, you should never issue public clients a refresh token (or any long-lived access token). The reason for this is that, depending on your backend architecture, these could be difficult to revoke should you need to revoke access to a specific client. For example, if you are using a JSON Web Token instead of a database record, you would need to blacklist all of them it to revoke them.</p>
</article></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"how-secure-is-the-oauth2-resource-owner-password-credential-flow-for-single-page-apps","contentHtml":"\u003cp\u003eI've been working on a single-page, browser-based app and I was investigating using the OAuth2 \"Resource Owner Password Credential\" (ROPC) flow to log users in without needing a normal OAuth popup or redirect. The single-page app is written by the same developers as the backend API, so it is more trusted than a third-party application (which should never touch a user's password). However, since it is a client-side application in Javascript, it was unclear to me how to take steps to make this as secure as possible, so I did some research. In this post, I'll describe what I found.\u003c/p\u003e\n\u003cp\u003eThe other issue is that Javascript clients cannot disguise their client credentials because the user may just \"view source\" to retrieve the credentials. This makes client impersonation possible. It also means the the client is a \"public\" client for the purposes of the OAuth spec, and client authentication is not possible. The OAuth spec states that when client authentication is not possible, the authorization server SHOULD employ other means to validate the client's identity.\u003c/p\u003e\n\u003cp\u003eSince we can't completely prevent client impersonation, we need to define what types of impersonation we are trying to prevent. For Javascript clients, I want to prevent two types of impersonation:\u003c/p\u003e\n\u003cp\u003eIn order to use the ROPC grant type for Javascript clients, we need to be more strict than the spec and absolutely ensure that the client is delivered over SSL. If the Javascript client is not delivered over SSL, a middleman could tamper with the client's Javascript to intercept either the resource owner's credentials or the access token. This makes it impossible for the resource owner to trust the client, which breaks the first chain of trust between the resource owner and the authorization server.\u003c/p\u003e\n\u003cp\u003eYou absolutely should implement some kind of rate-limiting on your token endpoint to prevent brute-force attacks.\u003c/p\u003e\n\u003cp\u003eFinally, you should never issue public clients a refresh token (or any long-lived access token). The reason for this is that, depending on your backend architecture, these could be difficult to revoke should you need to revoke access to a specific client. For example, if you are using a JSON Web Token instead of a database record, you would need to blacklist all of them it to revoke them.\u003c/p\u003e\n","layout":"post","status":"publish","published":true,"title":"How secure is the OAuth2 \"Resource Owner Password Credential\" flow for single-page apps?","author":{"display_name":"afiedler","login":"afiedler","email":"andy@andyfiedler.com","url":""},"author_login":"afiedler","author_email":"andy@andyfiedler.com","wordpress_id":282,"wordpress_url":"http://andyfiedler.com/?p=282","date":"2014-09-08 15:07:47 -0400","date_gmt":"2014-09-08 19:07:47 -0400","categories":["Tech Notes","Web Development"],"tags":["oauth"],"redirect_from":["/blog/how-secure-is-the-oauth2-resource-owner-password-credential-flow-for-single-page-apps-282/","/blog/how-secure-is-the-oauth2-resource-owner-password-credential-flow-for-single-page-apps-282"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"how-secure-is-the-oauth2-resource-owner-password-credential-flow-for-single-page-apps"},"buildId":"aq3bQL2RdL7dxufxvAbba","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>